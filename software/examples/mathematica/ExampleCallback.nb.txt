Needs["NETLink`"]
LoadNETAssembly["Tinkerforge",NotebookDirectory[]<>"../../.."]

host="localhost"
port=4223
uid="jmQ"(* Change to your UID *)

(* Create IPConnection and device object *)
ipcon=NETNew["Tinkerforge.IPConnection"]
b=NETNew["Tinkerforge.BrickletBarometer",uid,ipcon]
ipcon@Connect[host,port]

(* Set Period for air pressure and altitude callbacks to 1s (1000ms) *)
(* Note: The air pressure and altitude callbacks are only called every second *)
(*       if the air pressure or altitude has changed since the last call! *)
b@SetAirPressureCallbackPeriod[1000]
b@SetAltitudeCallbackPeriod[1000]

(* Callback function for air pressure callback (parameter has unit mbar/1000) *)
AirPressureCB[sender_,airPressure_]:=
 Print["Air Bressure: "<>ToString[N[Quantity[airPressure,"mbar/1000"]]]]
AddEventHandler[b@AirPressure,AirPressureCB]

(* Callback function for altitude callback (parameter has unit cm) *)
AltitudeCB[sender_,altitude_]:=
 Print["Altitude: "<>ToString[N[Quantity[altitude,"m/100"]]]]
AddEventHandler[b@Altitude,AltitudeCB]

Input["Click OK to exit"]

(* Clean up *)
ipcon@Disconnect[]
ReleaseNETObject[b]
ReleaseNETObject[ipcon]
